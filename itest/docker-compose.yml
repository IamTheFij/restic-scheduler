---
version: "3.9"

services:
  mysql:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: shhh
      MYSQL_DATABASE: main

  postgres:
    image: postgres
    environment:
      POSTGRES_PASSWORD: shhh
      POSTGRES_DB: main

  bootstrap:
    image: resticscheduler
    entrypoint: /bootstrap-tests.sh
    environment:
      MYSQL_HOST: mysql
      MYSQL_USER: root
      MYSQL_PWD: shhh
      PGSQL_HOST: postgres
      PGSQL_USER: postgres
      PGSQL_PASS: shhh
    volumes:
      - ./bootstrap-tests.sh:/bootstrap-tests.sh
      - ./data:/data

  main:
    image: resticscheduler
    environment:
      MYSQL_HOST: mysql
      MYSQL_USER: root
      MYSQL_PWD: shhh
      PGSQL_HOST: postgres
      PGSQL_USER: postgres
      PGSQL_PASS: shhh
    volumes:
      - ./repo:/repo
      - ./data:/data
      - ./test-backup.hcl:/test-backup.hcl

  validate:
    image: resticscheduler
    entrypoint: /validate-tests.sh
    environment:
      MYSQL_HOST: mysql
      MYSQL_USER: root
      MYSQL_PWD: shhh
      PGSQL_HOST: postgres
      PGSQL_USER: postgres
      PGSQL_PASS: shhh
    volumes:
      - ./validate-tests.sh:/validate-tests.sh
      - ./data:/data
